#reserved: Plus.800 to Plus.899

namespace = Plus

#######################################
# CELTIC EVENTS
#######################################
###CELTIC PAGAN EVENTS###

##CELTIC HEADHUNTER EVENTS
character_event = { #Celtic character takes first enemy head
	id = Plus.800
	desc = EVTDESC_Plus_800
	picture = GFX_evt_headhunter
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	option = {
		name = EVTOPTA_Plus_800
		if = {
			limit = { trait = head3 }
			remove_trait = head3
			add_trait = head4
		}
		if = {
			limit = { trait = head2 }
			remove_trait = head2
			add_trait = head3
		}
		if = {
			limit = { trait = head1 }
			remove_trait = head1
			add_trait = head2
		}
		if = {
			limit = {
				NOR = {
					trait = head1
					trait = head2
					trait = head3
					trait = head4
					trait = head5
				}
			}
			add_trait = head1
		}
	}
}
character_event = { #Celtic character takes fifth enemy head and becomes a legend
	id = Plus.801
	desc = EVTDESC_Plus_801
	picture = GFX_evt_headhunter
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	option = {
		name = EVTOPTA_Plus_801
		remove_trait = head4
		add_trait = head5
	}
}
character_event = { #Celtic hero takes a enemy head
	id = Plus.802
	desc = EVTDESC_Plus_800
	picture = GFX_evt_headhunter
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	option = {
		name = EVTOPTA_Plus_800
		prestige = 5
		piety = 2
	}
}

##CHANGELINGS
character_event = { #Baby stolen by the Fairies
	id = Plus.804
	hide_window = yes

	ai = yes
	max_age = 5
	prisoner = no
	is_triggered_only = yes

	trigger = {
		has_dlc = "The Old Gods"
		NOT = {
			has_game_rule = {
				name = supernatural_events
				value = off
			}
		}
		is_pagan_celtic = yes
		NOT = { any_sibling = { has_character_flag = changeling_child } }
		OR = {
			guardian = { trait = envious }
			mother_even_if_dead = { trait = envious }
			father_even_if_dead = { trait = envious }
		}
		OR = {
			guardian = { ai = no }
			has_game_rule = {
				name = supernatural_events
				value = unrestricted
			}
		}
	}
	immediate = {
		random_list = {
			25 = {
				set_character_flag = changeling_child
				set_character_flag = seelie
			}
			25 = {
				set_character_flag = changeling_child
				set_character_flag = unseelie
			}
			50 = { set_character_flag = changeling_child_fake }
		}
	}
}
character_event = { #Changeling child acting strange
	id = Plus.805
	hide_window = yes

	min_age = 4
	max_age = 15
	ai = yes
	prisoner = no
	has_character_flag = changeling_child
	is_triggered_only = yes

	trigger = {
		has_dlc = "The Old Gods"
		NOT = { has_character_flag = changeling_child_strange_3 }
	}

	immediate = {
		if = { #First time
			limit = {
				NOR = {
					has_character_flag = changeling_child_strange_1
					has_character_flag = changeling_child_strange_2
				}
			}
			set_character_flag = changeling_child_strange_1
		}
		else_if = { #Second time
			limit = {
				has_character_flag = changeling_child_strange_1
				NOT = { has_character_flag = changeling_child_strange_2 }
			}
			clr_character_flag = changeling_child_strange_1
			set_character_flag = changeling_child_strange_2
		}
		else_if = { #Third time
			limit = {
				has_character_flag = changeling_child_strange_2
			}
			clr_character_flag = changeling_child_strange_2
			set_character_flag = changeling_child_strange_3
		}
		else = { # Error Catching
			clr_character_flag = changeling_child_strange_1
			clr_character_flag = changeling_child_strange_2
			clr_character_flag = changeling_child_strange_3
			set_character_flag = changeling_child_strange_3
		}
		#Notify guardian
		guardian = { character_event = { id = Plus.806 } }
	}
}
character_event = { #Notify Guardian of Changeling Behavior
	id = Plus.806
	picture = GFX_evt_child_play
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes

	desc = { #First Time
		text = EVTDESC_ancrel_0217
		trigger = {
			FROM = {
				has_character_flag = changeling_child_strange_1
				NOR = {
					has_character_flag = changeling_child_strange_2
					has_character_flag = changeling_child_strange_3
				}
			}
		}
	}
	desc = { #Second Time
		text = EVTDESC_ancrel_0219
		trigger = {
			FROM = {
				has_character_flag = changeling_child_strange_2
				NOT = {
					has_character_flag = changeling_child_strange_3
				}
			}
		}
	}
	desc = { #Third Time
		text = EVTDESC_ancrel_0221
		trigger = {
			FROM = { has_character_flag = changeling_child_strange_3}
		}
	}

	option = {
		name = EVTOPTA_ancrel_0217
		custom_tooltip = { text = changeling_child_acts_strange }
	}
}
character_event = { #Changeling murders Courtier
	id = Plus.807
	hide_window = yes

	ai = yes
	min_age = 4
	max_age = 15
	prisoner = no
	has_character_flag = changeling_child
	is_triggered_only = yes

	trigger = {
		has_dlc = "The Old Gods"
		NOT = { has_character_flag = changeling_child_kills_3 }
		OR = {
			has_character_flag = changeling_child_strange_1
			has_character_flag = changeling_child_strange_2
			has_character_flag = changeling_child_strange_3
		}
		guardian = {
			any_courtier = {
				NOR = {
					character = ROOT
					is_close_relative = ROOT
				}
				host = {
					character = liege
					prisoner = no
				}
				ai = yes
				is_primary_heir = no
				is_pretender = no
				prisoner = no
				age = 13
				in_command_trigger = no
				NOT = { spouse = { character = host } }
			}
		}
	}

	immediate = {
		if = { #First time
			limit = {
				NOR = {
					has_character_flag = changeling_child_kills_1
					has_character_flag = changeling_child_kills_2
				}
			}
			set_character_flag = changeling_child_kills_1
		}
		else_if = { #Second time
			limit = {
				has_character_flag = changeling_child_kills_1
				NOT = { has_character_flag = changeling_child_kills_2 }
			}
			clr_character_flag = changeling_child_kills_1
			set_character_flag = changeling_child_kills_2
		}
		else_if = { #Third time
			limit = { has_character_flag = changeling_child_kills_2 }
			clr_character_flag = changeling_child_kills_2
			set_character_flag = changeling_child_kills_3
		}
		else = { #Error catching
			clr_character_flag = changeling_child_kills_1
			clr_character_flag = changeling_child_kills_2
			clr_character_flag = changeling_child_kills_3
			set_character_flag = changeling_child_kills_3
		}
		guardian = {
			random_courtier = {
				limit = {
					NOR = {
						character = ROOT
						is_close_relative = ROOT
					}
					host = {
						character = liege
						prisoner = no
					}
					ai = yes
					is_primary_heir = no
					is_pretender = no
					prisoner = no
					age = 13
					in_command_trigger = no
					NOT = { spouse = { character = host } }
				}
				character_event = { id = Plus.808 }
			}
		}
	}
}
character_event = { #Courtier Death (bounce to Liege)
	id = Plus.808
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		liege = { character_event = { id = Plus.809 } }
	}
}
character_event = { #Notify Guardian of Courtier death
	id = Plus.809
	picture = GFX_evt_viking_funeral_oldgods
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes

	desc = { #First time
		text = EVTDESC_ancrel_0224
		trigger = {
			FROMFROM = { has_character_flag = changeling_child_kills_1 }
		}
	}
	desc = { #Second time
		text = EVTDESC_ancrel_0227
		trigger = {
			FROMFROM = { has_character_flag = changeling_child_kills_2 }
		}
	}
	desc = { #Third time
		text = EVTDESC_ancrel_0230
		trigger = {
			FROMFROM = { has_character_flag = changeling_child_kills_3 }
		}
	}

	immediate = {
		FROM = {
			death = {
				death_reason = death_murder_unknown
			}
		}
	}

	option = { #First time
		name = EVTOPTA_ancrel_0224
		trigger = { FROMFROM = { has_character_flag = changeling_child_kills_1 } }
	}
	option = { #Second time
		name = EVTOPTA_ancrel_0227
		trigger = { FROMFROM = { has_character_flag = changeling_child_kills_2 } }
	}
	option = { #Third time
		name = EVTOPTA_ancrel_0230
		trigger = { FROMFROM = { has_character_flag = changeling_child_kills_3 } }
	}

}
character_event = { #Druid offers to save child (Setup)
	id = Plus.810
	hide_window = yes

	ai = yes
	min_age = 5
	max_age = 15
	is_triggered_only = yes

	trigger = {
		has_dlc = "The Old Gods"
		NOT = { has_character_flag = changeling_trade }
		OR = {
			has_character_flag = changeling_child
			has_character_flag = changeling_child_fake
		}
		guardian = {
			any_courtier = {
				NOT = { character = PREV }
				OR = {
					trait = druid
					trait = bad_druid
				}
			}
		}
	}

	immediate = {
		set_character_flag = changeling_trade
		save_event_target_as = changeling_child
		guardian = {
			random_courtier = {
				limit = {
					ai = yes
					NOT = { character = PREV }
					OR = {
						trait = druid
						trait = bad_druid
					}
				}
				save_event_target_as = changeling_trade_druid
			}
		}
		#Check which parent to give the event to
		if = { #Check the Father
			limit = {
				father_even_if_dead = {
					is_alive = yes
					OR = {
						#Not married to the child's mother and is a ruler while she is not
						AND = {
							is_ruler = yes
							NOT = {
								any_spouse = {
									is_ruler = no
									any_child = {
										character = ROOT
									}
								}
							}
						}
						#Patrilineally married to the child's mother
						any_spouse = {
							any_child = {
								character = ROOT
							}
							is_married_matrilineally = no
						}
						#Is a player and mother is not
						AND = {
							ai = no
							ROOT = {
								mother = {
									ai = yes
								}
							}
						}
					}
				}
			}
			father = { save_event_target_as = changeling_trade_parent }
		}
		else_if = { #Check the Mother
			limit = {
				mother_even_if_dead = {
					is_alive = yes
					OR = {
						#Not married to the child's father and is a ruler while he is not
						AND = {
							is_ruler = yes
							NOT = {
								any_spouse = {
									is_ruler = no
									any_child = {
										character = ROOT
									}
								}
							}
						}
						#Matrilineally married to the child's father
						any_spouse = {
							any_child = {
								character = ROOT
							}
							is_married_matrilineally = yes
						}
						#Is a player and father is not
						AND = {
							ai = no
							ROOT = {
								father = {
									ai = yes
								}
							}
						}
					}
				}
			}
			mother = { save_event_target_as = changeling_trade_parent }
		}
		else = { #Give it to the guardian if they're equally qualified or neither is
			guardian = { save_event_target_as = changeling_trade_parent }
		}
		event_target:changeling_trade_druid = {
			character_event = Plus.811
		}
	}
}
character_event = { #Druid offers to save child (the offer)
	id = Plus.811
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		event_target:changeling_trade_parent = {
			character_event = { id = Plus.812 }
		}
	}
}
character_event = { #Druid offeres to save child (Parent receives offer)
	id = Plus.812
	desc = EVTDESC_ancrel_0233
	picture = GFX_evt_viking_throneroom_oldgods
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes

	option = { #Yes
		name = EVTOPTA_ancrel_0233
		hidden_tooltip = {
			character_event = { id = Plus.813 days = 7 }
		}
		custom_tooltip = { text = changeling_trade_approved }
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				is_pagan_celtic = yes
				trait = zealous
			}
		}
	}
	option = { #No
		name = EVTOPTB_ancrel_0233
		event_target:changeling_trade_druid = {
			opinion = {
				modifier = opinion_very_disappointed
				years = 2
				who = ROOT
			}
		}
		custom_tooltip = { text = changeling_trade_denied }
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				OR = {
					event_target:changeling_trade_druid = { trait = bad_druid }
					trait = cynical
				}
			}
		}
	}
}
character_event = { #Trade begins
	id = Plus.813
	desc = EVTDESC_ancrel_0234
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_ancrel_0234
		custom_tooltip = {
			text = changeling_trade_begins
			hidden_tooltip = {
				event_target:changeling_trade_druid = {
					character_event = { id = Plus.814 days = 3 }
				}
			}
		}
	}
}
character_event = { #Changeling trade completed (Pick resolution and Bounce to Parent)
	id = Plus.814
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_list = {
			50 = { #Success
				modifier = { #If the kid was never really a changeling and the druid sucks, you're going to have a bad time
					factor = 0
					trait = bad_druid
					event_target:changeling_child = {
						has_character_flag = changeling_child_fake
					}
				}
				event_target:changeling_trade_parent = { set_character_flag = changeling_trade_successful }
			}
			10 = { #Druid Dies
				death = {
					death_reason = death_murder_unknown
				}
				event_target:changeling_trade_parent = { set_character_flag = changeling_trade_druid_dies }
			}
			20 = { #Child dies
				modifier = { #Incompentence breeds failure
					factor = 2
					trait = bad_druid
				}
				event_target:changeling_child = {
					death = {
						death_reason = death_sacrificed
					}
				}
				event_target:changeling_trade_parent = { set_character_flag = changeling_trade_child_dies }
			}
			20 = { #Child is hurt
				modifier = { #Incompentence breeds failure
					factor = 2
					trait = bad_druid
				}
				event_target:changeling_child = { add_trait = wounded }
				event_target:changeling_trade_parent = { set_character_flag = changeling_trade_child_injured }
			}
		}
		event_target:changeling_trade_parent = {
			character_event = { id = Plus.815 }
		}
	}
}
character_event = { #Parent notified of trade completion
	id = Plus.815
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes

	desc = { #Success
		text = EVTDESC_ancrel_0239
		trigger = {
			has_character_flag = changeling_trade_successful
		}
	}
	desc = { #Druid died
		text = EVTDESC_ancrel_0237
		trigger = {
			has_character_flag = changeling_trade_druid_dies
		}
	}
	desc = { #Child died
		text = EVTDESC_ancrel_0238
		trigger = {
			has_character_flag = changeling_trade_child_dies
		}
	}
	desc = { #Child hurt
		text = EVTDESC_ancrel_0240
		trigger = {
			has_character_flag = changeling_trade_child_injured
		}
	}

	option = { #Success! Remove possessed effect from child
		name = EVTOPTA_ancrel_0239
		trigger = { has_character_flag = changeling_trade_successful }
		hidden_tooltip = {
			event_target:changeling_child = {
				remove_possessed_effect = yes
			}
			clr_character_flag = changeling_trade_successful
		}
	}
	option = { #Druid died
		name = EVTOPTA_ancrel_0237
		trigger = { has_character_flag = changeling_trade_druid_dies }
		hidden_tooltip = {#Flags removed, no more events
			event_target:changeling_child = { clr_character_flag = changeling_trade }
			clr_character_flag = changeling_trade_druid_dies
		}
	}
	option = { #Child died, execute the druid
		name = EVTOPTA_ancrel_0238
		trigger = { has_character_flag = changeling_trade_child_dies }
		event_target:changeling_trade_druid = {
			death = {
				death_reason = death_execution
				killer = ROOT
			}
		}
		hidden_tooltip = { clr_character_flag = changeling_trade_child_dies}
	}
	option = { #Child died, banish the druid
		name = EVTOPTB_ancrel_0238
		trigger = { has_character_flag = changeling_trade_child_dies }
		event_target:changeling_trade_druid = { banish = yes }
		hidden_tooltip = { clr_character_flag = changeling_trade_child_dies}
	}
	option = { #Child died, do nothing to the druid
		name = EVTOPTC_ancrel_0238
		trigger = { has_character_flag = changeling_trade_child_dies }
		hidden_tooltip = { clr_character_flag = changeling_trade_child_dies}
	}
	option = { #Succeeded but child injured, banish the druid
		name = EVTOPTB_ancrel_0238
		trigger = { has_character_flag = changeling_trade_child_injured }
		event_target:changeling_child = { remove_possessed_effect = yes }
		event_target:changeling_trade_druid = { banish = yes }
		hidden_tooltip = { clr_character_flag = changeling_trade_child_injured }
	}
	option = { #Succeeded but child injured, do nothing to the druid
		name = EVTOPTC_ancrel_0238
		trigger = { has_character_flag = changeling_trade_child_injured }
		event_target:changeling_child = { remove_possessed_effect = yes }
		hidden_tooltip = { clr_character_flag = changeling_trade_child_injured }
	}
}
character_event = { #Changeling child becomes adult
	id = Plus.816
	desc = EVTDESC_ancrel_0241
	picture = GFX_evt_the_changeling_fuseli
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes

	has_character_flag = changeling_child

	immediate = { #Note: This event MAY need to be balanced further, but it is currently far better than it was
		clr_character_flag = changeling_child
		clr_character_flag = changeling_child_fake
		clr_character_flag = changeling_trade
		# Remove boring human physical traits
		remove_trait = dull
		remove_trait = slow
		remove_trait = imbecile
		remove_trait = weak
		remove_trait = feeble
		# Generally considered to be beautiful and smart
		add_trait = fair
		add_trait = quick
		add_trait = lefthanded
		# Give character physical attributes attributed to fey court they belong to
		if = { #Seelie
			limit = { has_character_flag = seelie }
			add_trait = imposing
			add_trait = powerful_voice
			clr_character_flag = seelie
		}
		else_if = { #Unseelie
			limit = { has_character_flag = unseelie }
			add_trait = agile
			add_trait = melodious_voice
			clr_character_flag = unseelie
		}
		else = { #Character somehow didn't have the flag. 50% chance of either
			random_list = {
				50 = {
					add_trait = imposing
					add_trait = powerful_voice
				}
				50 = {
					add_trait = imposing
					add_trait = powerful_voice
				}
			}
		}
		random_list = {
			90 = {}
			10 = {
				add_trait = lunatic
			}
		}
	}

	option = {
		name = EVTOPTA_ancrel_0241
		add_trait = changeling
	}
}
